generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int       @id @default(autoincrement())
  email        String    @unique
  passwordHash String
  createdAt    DateTime  @default(now())
  role         UserRole  @default(user)
  accounts     Account[]

  @@map("users")
}

model Account {
  id               Int           @id @default(autoincrement())
  userId           Int
  name             String
  makeConnection   String
  contextPrompt    String        @db.Text
  postingFrequency Int           @default(1)
  postingPeriod    PostingPeriod @default(week)
  postingDay       String?
  postingHour      String        @default("09:00")
  createdAt        DateTime      @default(now())
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  posts            Post[]

  @@index([userId], map: "accounts_userId_fkey")
  @@map("accounts")
}

model Post {
  id              Int              @id @default(autoincrement())
  imageUrl        String
  aiCaption       String?          @db.Text
  status          PostStatus       @default(draft)
  scheduledAt     DateTime?
  publishedAt     DateTime?
  createdAt       DateTime         @default(now())
  accountId       Int
  account         Account          @relation(fields: [accountId], references: [id], onDelete: Cascade)
  captionHistory  CaptionHistory[]

  @@index([accountId], map: "posts_accountId_fkey")
  @@map("posts")
}

model CaptionHistory {
  id              Int      @id @default(autoincrement())
  postId          Int
  previousCaption String?  @db.Text
  newCaption      String   @db.Text
  modifiedAt      DateTime @default(now())
  post            Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId], map: "caption_history_postId_fkey")
  @@map("caption_history")
}

enum UserRole {
  admin
  user
}

enum PostingPeriod {
  day
  week
  month
}

enum PostStatus {
  draft
  scheduled
  published
}
